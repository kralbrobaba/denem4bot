<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ba≈üla ‚Äî Wallet Panel (TRC20)</title>
  <style>
    :root{--bg:#071328;--card:#071a2b;--accent:#00d1b2;--muted:#96a7bd}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#061124,#07162a);color:#eaf6f3;padding:18px;}
    .wrap{max-width:820px;margin:0 auto}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#5fe9c7);display:flex;align-items:center;justify-content:center;color:#042024;font-weight:800}
    h1{margin:0;font-size:18px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:12px}
    .btn{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),#5fe9c7);color:#042024;font-weight:700;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}
    .section{margin-top:10px}
    input{width:100%;padding:10px;border-radius:8px;border:none;margin-top:8px}
    .mini{background:rgba(255,255,255,0.01);padding:12px;border-radius:10px}
    @media(max-width:820px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div style="display:flex;gap:12px;align-items:center">
          <div class="logo">US</div>
          <div>
            <h1>Ba≈üla ‚Äî TRC20 Panel</h1>
            <div class="small">Network: TRC20</div>
          </div>
        </div>
        <div class="small" id="usernameArea">Y√ºkleniyor...</div>
      </header>

      <div class="grid">
        <div>
          <div class="section mini">
            <div style="font-weight:700;font-size:20px" id="balance">$0.00</div>
            <div class="small" id="refInfo">Referrals >=$250: 0 ‚Äî Bonus: 0.00%</div>
            <div style="margin-top:10px">
              <button class="btn" onclick="playDaily()">üéÆ Play Daily (Mini Game)</button>
              <button class="btn secondary" onclick="openDeposit()">üí≥ Deposit (TX g√∂nder)</button>
              <button class="btn secondary" onclick="openWithdraw()">üèß Withdraw</button>
            </div>
          </div>

          <div class="section">
            <h3 style="margin:6px 0">Mini Games</h3>
            <p class="small">G√ºnde 1 kez oynayabilirsiniz. Kazan√ß %1-4 + referans bonusu.</p>
            <div id="miniMsg" class="small">Oynamak i√ßin Play Daily butonuna bas.</div>
          </div>

          <div class="section">
            <h3 style="margin:6px 0">How to</h3>
            <div class="small">‚Ä¢ Deposit: TRC20 USDT g√∂nderin, TX hash + miktar g√∂nderin. <br>‚Ä¢ Withdraw: Adres + miktar g√∂nderin, admin onayƒ± sonrasƒ± manuel √∂denir.</div>
          </div>
        </div>

        <div>
          <div class="section">
            <div class="small">Referral Link</div>
            <div id="refLink" style="color:var(--accent);word-break:break-all">‚Äî</div>
          </div>

          <div class="section">
            <div class="small">Platform Deposit Address</div>
            <div id="depositAddr" style="font-weight:700;margin-top:6px">TRC20: PLACEHOLDER</div>
          </div>

          <div class="section">
            <h3 style="margin:6px 0">History</h3>
            <div id="history">Ge√ßmi≈ü y√ºklenmedi.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  // set deposit address from server-side replaced placeholder if needed
  document.getElementById('depositAddr').innerText = 'TRC20: ' + (tg.initDataUnsafe?.user?.id ? '' : '') ;
  // request profile on load
  function requestProfile(){
    tg.sendData(JSON.stringify({type:'request_profile'}));
  }
  requestProfile();

  // WebApp actions
  function openDeposit(){
    const tx = prompt('TX hash ve miktar (√∂rnek: TXHASH123,100)');
    if(!tx) return;
    tg.sendData(JSON.stringify({type:'deposit', payload: tx}));
    setMiniMsg('Deposit g√∂nderildi ‚Äî admin onayƒ± bekleniyor.');
  }
  function openWithdraw(){
    const val = prompt('Adres ve miktar (√∂rnek: Tabc...,50)');
    if(!val) return;
    tg.sendData(JSON.stringify({type:'withdraw', payload: val}));
    setMiniMsg('Withdraw talebi g√∂nderildi ‚Äî admin onayƒ± bekleniyor.');
  }
  function playDaily(){
    tg.sendData(JSON.stringify({type:'play_daily'}));
    setMiniMsg('Daily oynama talebi g√∂nderildi...');
  }
  function setMiniMsg(t){ document.getElementById('miniMsg').innerText = t; }

  // Listen for messages from bot (bot replies with JSON strings)
  // Telegram Web App receives bot messages as regular chat messages; we can parse them by listening to window 'message' events from parent (some clients deliver differently).
  // Safer approach: when bot replies with a JSON payload, it will be shown in the chat ‚Äî users can click refresh. But we'll attempt to parse incoming postMessage events.

  window.addEventListener('message', (ev) => {
    // Many clients won't post messages ‚Äî include fallback
    try {
      const d = ev.data;
      if (typeof d === 'string') {
        const obj = JSON.parse(d);
        if (obj.balance !== undefined) {
          document.getElementById('balance').innerText = '$' + Number(obj.balance).toFixed(2);
          document.getElementById('refInfo').innerText = 'Referrals >=$250: ' + obj.ref_count + ' ‚Äî Bonus: ' + (Math.min(obj.ref_count,5)*0.5).toFixed(2) + '%';
          document.getElementById('refLink').innerText = obj.ref_link;
          document.getElementById('depositAddr').innerText = obj.deposit_address || '';
        }
      }
    } catch (e) { /* ignore parse errors */ }
  });

  // Also provide a simple polling: user can press the Ba≈üla button again to refresh via sendData
  // (bot will reply with JSON string containing balance/ref info)
</script>
</body>
</html>
